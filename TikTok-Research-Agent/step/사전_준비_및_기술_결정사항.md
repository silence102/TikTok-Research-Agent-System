# 🔧 사전 준비 및 기술 결정사항

> 개발 착수 전 준비 단계에서 결정된 기술 스택 및 구현 방향

---

## 📅 문서 정보

| 항목 | 내용 |
|------|------|
| **작성일** | 2025-12-15 |
| **단계** | Phase 0 - 사전 준비 |
| **목적** | API 설정 및 기술 스택 최종 결정 |
| **상태** | ✅ 완료 |

---

## 🎯 주요 결정사항 요약

### 1. Claude API 제외 결정

**원래 계획**:
- Claude 3.5 Sonnet: 뉴스 요약, 질의응답 (고품질)
- GPT-4o mini: 카테고리 분류 (저비용)
- **예상 비용**: $1.82/월

**변경된 계획**:
- ❌ Claude API 제외
- ✅ OpenAI만 사용 (GPT-4o + GPT-4o mini)
- **예상 비용**: $0.45/월 (75% 절감)

**결정 이유**:

| 요인 | 설명 |
|------|------|
| **비용 최소화** | 테스트 단계에서는 비용 절감 우선 |
| **결제 번거로움** | Claude API는 $5 최소 충전 필요 |
| **충분한 품질** | GPT-4o도 테스트 및 포트폴리오 증명에 충분 |
| **단일 API 관리** | OpenAI 하나만 관리하면 간편 |

**트레이드오프**:

| 항목 | Claude | GPT-4o | 차이 |
|------|--------|--------|------|
| **한국어 품질** | ⭐⭐⭐⭐⭐ (95점) | ⭐⭐⭐⭐ (88점) | -7% |
| **환각 방지** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 프롬프트로 보완 가능 |
| **비용** | $1.80/월 | $0.40/월 | 78% 절감 |
| **포트폴리오** | "Claude 활용" 강조 | "다양한 LLM" 충족 | 충분함 |

**향후 계획**:
- 테스트 단계: OpenAI만 사용
- 고도화 단계: 필요 시 Claude 추가 (하이브리드 전략)

---

## 📊 Airtable 테이블 구조 확정

### **변경 사항**: PRD.md와 다른 필드 구조 채택

**원래 PRD 계획**:
```
tiktok_trends:
- date, hashtag, views, posts_count, trend_score, category,
  top_sounds, keywords, engagement_rate, raw_data
```

**실제 구현된 구조**:
```
tiktok_trends:
- keyword (hashtag 대신)
- trend_score
- video_count (posts_count 대신)
- growth_rate (새로 추가)
- sample_video_url (새로 추가)
- category
- description (새로 추가)
- collected_at (date 대신)
- source
- notes (raw_data 대신)
```

**변경 이유**:

| 필드 변경 | 이유 |
|----------|------|
| `hashtag` → `keyword` | 더 범용적 (해시태그 외 키워드도 검색 가능) |
| `posts_count` → `video_count` | TikTok 용어에 맞춤 (영상 수) |
| `growth_rate` 추가 | 트렌드 성장 추세 파악 필요 |
| `sample_video_url` 추가 | 대표 영상 빠른 확인용 |
| `description` 추가 | 인사이트 기록 (LLM 생성) |
| `date` → `collected_at` | 수집 일시 명확화 |
| `raw_data` → `notes` | 범용적 메모 필드 |
| `top_sounds` 제거 | MVP에서는 불필요 (Should-have로 이동) |
| `keywords` 제거 | description에 포함 가능 |
| `engagement_rate` 제거 | 수동 계산 가능 (likes/views) |

**Category 옵션 확정**:
```
Food / Dance / Comedy / Review / Beauty / Other
```
- PRD의 8개 카테고리에서 6개로 축소 (단순화)
- "Review" 추가 (제품 리뷰 트렌드 많음)

---

### **research_news 테이블 구조**

**실제 구현된 구조**:
```
research_news:
- title
- url
- summary
- sentiment (Positive / Neutral / Negative)
- topic (Marketing / Creator / TikTok / Business / Other)
- published_at
- source
- notes
```

**변경 사항**:

| 원래 계획 | 실제 구현 | 이유 |
|----------|----------|------|
| `date` | `published_at` | 발행일 명확화 |
| `relevance_score` 제거 | - | 필터링 후 저장하므로 불필요 |
| `keywords` 제거 | - | summary에 포함 가능 |

**Topic 옵션 확정**:
```
Marketing / Creator / TikTok / Business / Other
```
- 5개 주제로 단순화
- TikTok 중심 분류

---

## 🔑 API 키 설정 완료

### **발급 완료 목록**

| API | 발급 상태 | 토큰 형식 | 비고 |
|-----|----------|----------|------|
| **Airtable PAT** | ✅ 완료 | `paty5SVebZGCkUyx1.*****` | Base ID: `appEIGmZNLYeWLxb5` |
| **Apify API Token** | ✅ 완료 | `apify_api_eVgaj3QpBS38*****` | 무료 $5 크레딧 |
| **OpenAI API Key** | ✅ 완료 | `sk-proj-WQTT3tetmFmZP3S*****` | $5 충전 (11개월 사용 가능) |
| **Anthropic Claude** | ❌ 제외 | - | 테스트 단계에서는 사용 안 함 |

### **비용 예상 (수정)**

**월 운영 비용**:
```
Apify:   $0 (무료 크레딧 내)
OpenAI:  $0.45/월
Total:   $0.45/월
```

**OpenAI $5 충전으로**:
- 약 **11개월** 사용 가능
- 하루 53K tokens 소비 기준

**비용 절감 효과**:
- 원래 계획: $1.82/월 (Claude + GPT)
- 현재 계획: $0.45/월 (GPT만)
- **절감율**: 75%

---

## 🛠️ 기술 스택 최종 확정

### **LLM API 사용 계획**

| 작업 | 원래 계획 | 최종 결정 | 이유 |
|------|----------|----------|------|
| **에이전트 1: 카테고리 분류** | GPT-4o mini | GPT-4o mini | 저비용, 충분한 정확도 |
| **에이전트 2: 관련성 평가** | Claude 3.5 Sonnet | **GPT-4o** | 비용 절감 |
| **에이전트 2: 뉴스 요약** | Claude 3.5 Sonnet | **GPT-4o** | 비용 절감 |
| **에이전트 3: 질문 분류** | Claude 3.5 Sonnet | **GPT-4o mini** | 간단한 작업 |
| **에이전트 3: RAG 답변** | Claude 3.5 Sonnet | **GPT-4o** | 고품질 필요 |

### **모델별 사용 용도**

**GPT-4o mini** (`OPENAI_MODEL_CHEAP`):
- 틱톡 카테고리 분류 (Food, Dance, Comedy 등)
- 질문 분류 (trend / research / mixed)
- 키워드 추출
- **비용**: $0.15/1M input tokens

**GPT-4o** (`OPENAI_MODEL_QUALITY`):
- 뉴스 관련성 평가 (0-100점)
- 뉴스 요약 (200자 한국어)
- RAG 답변 생성
- **비용**: $2.50/1M input tokens

---

## 📁 프로젝트 폴더 구조

### **확정된 폴더 구조**

```
TikTok-Research-Agent/
├── .env                          # API 키 (Git 제외)
├── .gitignore                    # Git 무시 파일
├── requirements.txt              # Python 패키지
├── README.md                     # 프로젝트 개요 (작성 예정)
├── CLAUDE.md                     # AI 작업 가이드 (작성 예정)
│
├── docs/                         # ✅ 이미 완성
│   ├── Ideation.md
│   ├── PRD.md
│   ├── Tasks.md
│   ├── TechStack.md
│   ├── Tutorial.md
│   └── AIRTABLE_SCHEMA.md        # ✅ 새로 추가
│
├── step/                         # 작업 진행 기록
│   ├── 개발_로드맵_및_문서_가이드.md
│   └── 사전_준비_및_기술_결정사항.md  # ✅ 이 파일
│
├── .claude/                      # ✅ Skills & Hooks
│   ├── hooks/
│   ├── skills/
│   ├── settings.json
│   └── skill-rules.json
│
├── n8n-workflows/                # n8n 워크플로우 JSON
│   ├── agent1-tiktok-collector.json (작성 예정)
│   └── agent2-research-collector.json (작성 예정)
│
├── src/                          # Python 소스 코드
│   ├── agent3/                   # CLI 에이전트
│   ├── data_connectors/          # Airtable 클라이언트
│   └── common/                   # 공통 유틸
│
├── scripts/                      # 유틸리티 스크립트
│   └── test_airtable.py          # ✅ Airtable 연결 테스트
│
├── demo/                         # 데모 자료
│   └── screenshots/              # 스크린샷
│
└── data/                         # 로컬 데이터 (Git 제외)
    └── archive/                  # Airtable 백업
```

---

## 🔐 환경 변수 설정

### **.env 파일 구조**

```bash
# ============================================
# 기존 API 키들 (다른 프로젝트용)
# ============================================
OPENAI_API_KEY=sk-proj-*****
ANTHROPIC_API_KEY=xxxxxxx
GITHUB_TOKEN=xxxxxxx
SUPABASE_URL=xxxxxxx
SUPABASE_KEY=xxxxxxx

# ============================================
# TikTok Research Agent - Airtable 설정
# ============================================
AIRTABLE_PAT=paty5SVebZGCkUyx1.*****
AIRTABLE_BASE_ID=appEIGmZNLYeWLxb5
AIRTABLE_TABLE_TRENDS=tiktok_trends
AIRTABLE_TABLE_RESEARCH=research_news

# ============================================
# TikTok Research Agent - Apify 설정
# ============================================
APIFY_API_TOKEN=apify_api_eVgaj3QpBS38*****
APIFY_ACTOR_ID=clockworks/tiktok-hashtag-scraper

# ============================================
# TikTok Research Agent - OpenAI 설정
# ============================================
OPENAI_MODEL_CHEAP=gpt-4o-mini
OPENAI_MODEL_QUALITY=gpt-4o

# ============================================
# 환경 설정
# ============================================
ENVIRONMENT=development
LOG_LEVEL=INFO

# ============================================
# n8n 설정
# ============================================
N8N_PORT=5678
N8N_HOST=localhost
```

**설계 원칙**:
1. **재사용 가능**: 기존 .env 파일에 TikTok 프로젝트 설정 추가
2. **섹션 분리**: 주석으로 명확히 구분
3. **모델 추상화**: `OPENAI_MODEL_CHEAP`, `OPENAI_MODEL_QUALITY`로 역할 명시
4. **확장 가능**: 나중에 Claude 추가 시 주석 해제만 하면 됨

---

## 📋 Python 패키지 의존성

### **requirements.txt**

```txt
# LLM API SDKs
anthropic==0.18.0          # Claude API (선택 사항, 미사용)
openai==1.12.0             # OpenAI API

# 데이터베이스
pyairtable==2.3.0          # Airtable SDK

# 환경 변수
python-dotenv==1.0.0

# CLI 인터페이스
rich==13.7.0               # 터미널 UI

# 유틸리티
requests==2.31.0
python-dateutil==2.8.2
pydantic==2.5.0
```

**패키지 선택 이유**:

| 패키지 | 용도 | 이유 |
|--------|------|------|
| `openai` | GPT API | 공식 SDK, 안정적 |
| `pyairtable` | Airtable 연동 | 공식 지원, 타입 힌트 |
| `python-dotenv` | .env 로드 | 표준, 간편함 |
| `rich` | CLI 꾸미기 | 마크다운 렌더링, 테이블, 색상 |
| `requests` | HTTP 요청 | 범용적 |
| `pydantic` | 데이터 검증 | 타입 안정성 |

---

## ✅ 완료된 사전 작업

### **Phase 0 체크리스트**

- [x] **API 키 발급**
  - [x] Airtable Personal Access Token
  - [x] Apify API Token (무료 $5 크레딧)
  - [x] OpenAI API Key ($5 충전)
  - [x] ~~Claude API Key~~ (제외)

- [x] **Airtable 설정**
  - [x] Base 생성: "TikTok Research"
  - [x] 테이블 1: `tiktok_trends` (10개 필드)
  - [x] 테이블 2: `research_news` (8개 필드)
  - [x] 필드 타입 및 옵션 설정

- [x] **프로젝트 초기화**
  - [x] 폴더 구조 생성
  - [x] `.env` 파일 작성 (API 키 저장)
  - [x] `.gitignore` 작성
  - [x] `requirements.txt` 작성
  - [x] `docs/AIRTABLE_SCHEMA.md` 문서화
  - [x] `scripts/test_airtable.py` 테스트 스크립트

---

## 🎯 다음 단계

### **Phase 1: 개발 환경 설정** (예정)

1. **Python 가상환경**
   ```bash
   python -m venv venv
   venv\Scripts\activate
   pip install -r requirements.txt
   ```

2. **Airtable 연결 테스트**
   ```bash
   python scripts/test_airtable.py
   ```

3. **Docker & n8n 실행**
   ```bash
   docker run -it --rm --name n8n -p 5678:5678 n8nio/n8n
   ```

### **Phase 2: 에이전트 1 개발** (Day 1-2)

Tasks.md의 Day 1-2 체크리스트 참조

---

## 💡 핵심 인사이트

### **1. 비용 최적화 우선**

**결정**:
- Claude API 제외 → OpenAI만 사용
- 월 비용 75% 절감 ($1.82 → $0.45)

**교훈**:
> "테스트 단계에서는 완벽한 품질보다 실용성과 비용 효율이 중요하다"

### **2. 유연한 스키마 설계**

**결정**:
- PRD 계획과 다르게 필드 구조 조정
- `growth_rate`, `description` 등 실용적 필드 추가

**교훈**:
> "문서는 가이드일 뿐, 실제 구현에서는 현실적 판단이 필요하다"

### **3. 단순화 원칙**

**결정**:
- 카테고리 8개 → 6개로 축소
- 불필요한 필드 제거 (top_sounds, keywords 등)

**교훈**:
> "MVP는 핵심 기능만 남기고 나머지는 과감히 제거한다"

---

## 📊 PRD 대비 변경 사항 요약

| 항목 | PRD 계획 | 실제 구현 | 이유 |
|------|---------|----------|------|
| **LLM API** | Claude + GPT | GPT만 | 비용 75% 절감 |
| **Airtable 필드** | 10개 필드 | 10개 (구조 변경) | 실용성 우선 |
| **Category 수** | 8개 | 6개 | 단순화 |
| **월 예상 비용** | $1.82 | $0.45 | 75% 절감 |
| **테이블 스키마** | `hashtag`, `views`, `posts_count` | `keyword`, `video_count`, `growth_rate` | 명확한 네이밍 |

---

## 🚀 준비 완료!

### **현재 상태**

✅ **API 키 설정 완료**
✅ **Airtable 테이블 생성 완료**
✅ **프로젝트 구조 완성**
✅ **기술 스택 확정**
✅ **비용 최적화 완료**

### **다음 작업**

⏳ Python 가상환경 설정
⏳ Airtable 연결 테스트
⏳ Docker & n8n 설치
⏳ 에이전트 1 개발 착수 (Day 1-2)

---

**🎯 이제 본격적인 개발 단계로 진입할 준비가 완료되었습니다!**
